# 启玩星球（PlayNova）MVP开发指南

## 1. MVP阶段简化建议

### 1.1 可暂时省略的模块

#### 前端部分
- [ ] **音频系统（AudioSystem）**: MVP阶段可以先使用简单的HTML5 Audio API
- [ ] **完整的动画系统**: 使用CSS动画代替复杂的Canvas动画
- [ ] **成就系统**: 暂不实现，专注于核心游戏玩法
- [ ] **排行榜**: 暂不实现社交功能
- [ ] **多语言支持**: MVP阶段仅支持中文
- [ ] **主题切换**: 先完成默认主题
- [ ] **离线功能**: MVP阶段需要网络连接

#### 后端部分
- [ ] **订阅模块（Subscription）**: MVP阶段免费使用所有功能
- [ ] **AI分析模块**: 暂不实现AI功能
- [ ] **WebSocket服务**: 暂不需要实时功能
- [ ] **消息队列**: MVP阶段同步处理即可
- [ ] **全文搜索**: 使用数据库简单查询
- [ ] **邮件服务**: 暂不发送通知邮件
- [ ] **数据导出**: 暂不提供Excel/PDF导出

#### 基础设施部分
- [ ] **ELK日志聚合**: 使用本地日志文件
- [ ] **Kibana可视化**: 暂不需要复杂的数据分析
- [ ] **多区域部署**: MVP阶段单区域部署
- [ ] **负载均衡**: 单实例部署
- [ ] **自动扩缩容**: 手动管理资源

### 1.2 必须从第一天就规范的部分

#### 架构设计
- [x] **模块化设计**: 清晰的目录结构，高内聚低耦合
- [x] **类型安全**: 前后端全面使用TypeScript
- [x] **API规范**: 统一的API设计规范（RESTful）
- [x] **错误处理**: 全局异常处理和统一错误响应
- [x] **配置管理**: 环境变量管理，配置与代码分离

#### 数据库设计
- [x] **Prisma ORM**: 类型安全的数据库访问
- [x] **索引设计**: 核心查询字段建立索引
- [x] **迁移管理**: 使用Prisma Migrations管理数据库变更
- [x] **关系设计**: 正确的外键关系和级联删除
- [x] **JSONB字段**: 灵活存储游戏配置和题目数据

#### 安全设计
- [x] **JWT认证**: 访问令牌 + 刷新令牌机制
- [x] **密码加密**: bcrypt加密存储
- [x] **输入验证**: 所有API输入验证
- [x] **CORS配置**: 严格的CORS白名单
- [x] **环境变量**: 敏感信息不提交到代码仓库
- [x] **HTTPS**: 生产环境必须使用HTTPS

#### 代码质量
- [x] **ESLint/Prettier**: 代码风格统一
- [x] **Git规范**: 规范的commit message
- [x] **单元测试**: 核心业务逻辑必须有测试
- [x] **代码审查**: 重要代码必须经过审查
- [x] **文档注释**: 关键函数和模块必须有注释

---

## 2. MVP功能优先级

### Phase 1: 核心基础（Week 1-2）

#### 目标：搭建基础框架，实现用户系统

**前端**
- [x] 项目初始化（Vite + React + TypeScript）
- [x] 基础路由配置
- [x] 认证页面（登录、注册）
- [x] 基础UI组件库（Button、Card、Modal等）
- [x] API服务层封装
- [x] 状态管理配置（Zustand）

**后端**
- [x] 项目初始化（NestJS + Prisma + PostgreSQL）
- [x] 数据库Schema设计
- [x] 认证模块（JWT + Refresh Token）
- [x] 用户模块（CRUD）
- [x] 全局异常处理
- [x] 输入验证管道

**基础设施**
- [x] Docker配置
- [x] Docker Compose开发环境
- [x] 环境变量管理
- [x] Git仓库初始化

### Phase 2: 游戏引擎（Week 3）

#### 目标：实现核心游戏引擎框架

**游戏引擎**
- [x] GameManager实现
- [x] EventBus实现
- [x] ScoreSystem实现
- [x] TimerSystem实现
- [x] GameModule接口定义
- [x] GameState接口定义
- [x] GameInput接口定义

**核心接口**
- [x] 游戏配置接口
- [x] 关卡配置接口
- [x] 题目数据接口

### Phase 3: 第一个游戏（Week 4-5）

#### 目标：实现拖拽游戏模块

**后端**
- [x] 游戏模块API
- [x] 关卡模块API
- [x] 题目数据填充（Seed）
- [x] 游戏记录API
- [x] 关卡进度API

**前端**
- [x] 拖拽游戏UI组件
- [x] 游戏页面（GamePlay）
- [x] 结果页面（Result）
- [x] 关卡选择页面
- [x] 游戏选择页面
- [x] 首页（Home）

**游戏逻辑**
- [x] 拖拽游戏实现GameModule接口
- [x] 关卡配置管理
- [x] 分数计算
- [x] 星级评定
- [x] 关卡解锁逻辑

### Phase 4: 第二个游戏（Week 6-7）

#### 目标：实现配对游戏模块

**后端**
- [x] 配对游戏题目数据
- [x] 关卡配置

**前端**
- [x] 配对游戏UI组件
- [x] 配对游戏逻辑
- [x] 游戏动画效果

### Phase 5: 家长控制台（Week 8）

#### 目标：实现家长管理功能

**后端**
- [x] 家长-孩子关联关系
- [x] 孩子游戏记录查询
- [x] 学习进度统计API

**前端**
- [x] 家长仪表盘
- [x] 孩子列表
- [x] 游戏记录查看
- [x] 学习进度图表（使用简单图表库）

### Phase 6: 优化与测试（Week 9-10）

#### 目标：性能优化和测试

**性能优化**
- [x] 前端代码分割
- [x] 图片懒加载
- [x] API响应缓存
- [x] 数据库查询优化

**测试**
- [x] 单元测试（核心业务逻辑）
- [x] 集成测试（API端点）
- [x] E2E测试（关键用户流程）
- [x] 性能测试

**文档**
- [x] API文档（Swagger）
- [x] 部署文档
- [x] 用户手册

---

## 3. 技术选型对比

### 3.1 前端状态管理

| 方案 | 优点 | 缺点 | 选择 |
|------|------|------|------|
| Zustand | 轻量、简单、无样板代码 | 社区相对较小 | ✅ 推荐（MVP） |
| Redux Toolkit | 生态成熟、工具完善 | 样板代码多 | - |
| Context API | 内置、无需额外依赖 | 性能较差、需要手动优化 | - |

**选择理由**: Zustand轻量简单，适合游戏场景，且易于学习。

### 3.2 动画方案

| 方案 | 优点 | 缺点 | 选择 |
|------|------|------|------|
| CSS Animations | 简单、性能好 | 复杂动画困难 | ✅ 推荐（MVP） |
| PixiJS | 强大、高性能 | 学习曲线陡峭 | - |
| GSAP | 功能强大 | 体积较大、需要付费 | - |
| Framer Motion | React友好 | 体积较大 | - |

**选择理由**: MVP阶段使用CSS动画足够，后期可升级到PixiJS。

### 3.3 后端认证方案

| 方案 | 优点 | 缺点 | 选择 |
|------|------|------|------|
| JWT + Refresh Token | 无状态、易扩展 | 无法主动撤销 | ✅ 推荐（MVP） |
| Session + Cookie | 可主动撤销、安全 | 有状态、扩展性差 | - |
| OAuth 2.0 | 第三方登录 | 复杂度高 | - |

**选择理由**: JWT适合分布式系统，Refresh Token解决了安全问题。

### 3.4 对象存储方案

| 方案 | 优点 | 缺点 | 选择 |
|------|------|------|------|
| AWS S3 | 稳定、功能完善 | 成本较高 | ✅ 推荐（MVP） |
| MinIO | 自托管、成本低 | 需要维护 | - |
| 阿里云OSS | 国内访问快 | 仅限国内 | - |

**选择理由**: AWS S3成熟稳定，MinIO可用于开发环境。

---

## 4. MVP技术债务管理

### 4.1 技术债务记录

```markdown
# TECH-DEBT.md

## 高优先级（必须在v1.1解决）

1. **音频系统**: 当前使用简单HTML5 Audio，需要实现AudioSystem
   - 影响: 游戏体验
   - 工作量: 2天
   - 负责人: 待分配

2. **错误监控**: 缺少生产环境错误监控（Sentry）
   - 影响: 问题定位困难
   - 工作量: 1天
   - 负责人: 待分配

## 中优先级（v1.2考虑）

1. **缓存策略**: 当前仅有基础Redis缓存，需要完善缓存策略
   - 影响: 性能
   - 工作量: 3天
   - 负责人: 待分配

2. **API文档**: Swagger文档不完整
   - 影响: 团队协作
   - 工作量: 2天
   - 负责人: 待分配

## 低优先级（以后再说）

1. **单元测试覆盖率**: 当前覆盖率不足50%
   - 影响: 代码质量
   - 工作量: 5天
   - 负责人: 待分配
```

### 4.2 代码重构时机

**何时重构**:
- 功能实现超过预期时间
- 添加新功能困难
- Bug频繁出现在同一模块
- 代码审查发现严重问题

**重构原则**:
- 不影响现有功能
- 逐步重构，不要大规模重写
- 重构后必须有测试覆盖
- 记录重构原因和结果

---

## 5. MVP质量标准

### 5.1 性能标准

| 指标 | 目标值 | 测量方法 |
|------|--------|----------|
| 首屏加载时间 | < 2s | Lighthouse |
| API响应时间 | < 200ms (P95) | APM工具 |
| 页面FPS | > 55 | Chrome DevTools |
| 内存占用 | < 100MB | Chrome DevTools |
| 数据库查询 | < 50ms (P95) | 慢查询日志 |

### 5.2 可用性标准

| 指标 | 目标值 | 说明 |
|------|--------|------|
| 系统可用性 | 99.5% | 月度目标 |
| 错误率 | < 0.1% | API错误率 |
| Bug修复时间 | < 24小时 | 严重Bug |
| 用户满意度 | > 4.0/5.0 | 问卷调查 |

### 5.3 代码质量标准

| 指标 | 目标值 | 工具 |
|------|--------|------|
| TypeScript覆盖率 | 100% | TypeScript |
| ESLint警告数 | 0 | ESLint |
| 单元测试覆盖率 | > 60% | Jest |
| 圈复杂度 | < 10 | SonarQube |
| 代码重复率 | < 5% | SonarQube |

---

## 6. MVP发布检查清单

### 6.1 功能检查

#### 核心功能
- [ ] 用户可以注册和登录
- [ ] 家长可以添加孩子账户
- [ ] 用户可以选择游戏类型
- [ ] 用户可以选择关卡
- [ ] 用户可以完成游戏
- [ ] 系统记录游戏结果
- [ ] 系统计算分数和星级
- [ ] 关卡解锁逻辑正常工作
- [ ] 家长可以查看孩子游戏记录
- [ ] 家长可以查看学习进度

#### 基础功能
- [ ] 密码重置功能
- [ ] 用户资料编辑
- [ ] 头像上传
- [ ] 游戏历史查看
- [ ] 个人中心

### 6.2 技术检查

#### 性能
- [ ] 首屏加载时间 < 2s
- [ ] API响应时间 P95 < 200ms
- [ ] 页面FPS > 55
- [ ] 数据库查询优化

#### 安全
- [ ] 所有API都有认证（除登录注册）
- [ ] 密码使用bcrypt加密
- [ ] 输入验证完整
- [ ] XSS防护
- [ ] CSRF防护
- [ ] HTTPS配置
- [ ] 环境变量安全

#### 兼容性
- [ ] Chrome最新版
- [ ] Safari最新版
- [ ] Firefox最新版
- [ ] Edge最新版
- [ ] 移动端浏览器测试

### 6.3 文档检查

- [ ] README.md完整
- [ ] API文档（Swagger）
- [ ] 部署文档
- [ ] 用户手册
- [ ] 代码注释充分

### 6.4 测试检查

- [ ] 单元测试（核心逻辑）
- [ ] 集成测试（API）
- [ ] E2E测试（关键流程）
- [ ] 性能测试
- [ ] 安全测试
- [ ] 兼容性测试

---

## 7. MVP后续迭代计划

### v1.1 (MVP后1个月)

**新功能**:
- [ ] 计数游戏模块
- [ ] 拼图游戏模块
- [ ] 成就系统
- [ ] 音频系统完善
- [ ] 错误监控集成（Sentry）

**优化**:
- [ ] 性能优化
- [ ] 用户体验优化
- [ ] 移动端适配优化

### v1.2 (MVP后2个月)

**新功能**:
- [ ] 排序游戏模块
- [ ] 排行榜系统
- [ ] 邮件通知
- [ ] 数据导出功能

**优化**:
- [ ] 缓存策略完善
- [ ] 数据库优化
- [ ] 监控告警完善

### v2.0 (MVP后3-6个月)

**新功能**:
- [ ] 微信小程序版本
- [ ] 订阅系统
- [ ] AI分析功能
- [ ] 实时对战功能

**架构升级**:
- [ ] 微服务架构
- [ ] 多区域部署
- [ ] 自动扩缩容

---

## 8. MVP开发建议

### 8.1 开发原则

1. **先做减法，再做加法**
   - 专注核心功能
   -砍掉非必要功能
   -简化用户流程

2. **快速迭代，小步快跑**
   -每周一个里程碑
   -频繁发布测试版本
   -及时收集反馈

3. **质量优先，速度第二**
   -代码质量不能妥协
   -必须写测试
   -必须代码审查

4. **用户为中心**
   -从用户视角思考
   -简化操作流程
   -优化用户体验

### 8.2 常见陷阱

**❌ 避免过度设计**
- 不要为了"未来"设计复杂架构
- 不要实现暂时不需要的功能
- 不要追求完美的代码

**❌ 避免忽视安全**
- 不要在代码中硬编码密钥
- 不要忽视输入验证
- 不要在生产环境关闭安全检查

**❌ 避免忽视测试**
- 不要说"以后再写测试"
- 不要只测试快乐路径
- 不要忽视边界情况

**❌ 避免忽视文档**
- 不要说"代码就是文档"
- 不要不写API文档
- 不要不更新文档

### 8.3 成功指标

**MVP成功标准**:
- ✅ 完成Phase 1-6所有功能
- ✅ 通过所有测试检查
- ✅ 性能指标达标
- ✅ 安全检查通过
- ✅ 至少100个测试用户
- ✅ 用户反馈正面

**KPI指标**:
- 用户注册数: > 100
- 日活跃用户: > 30
- 游戏完成率: > 70%
- 用户留存率（7天）: > 40%
- 用户满意度: > 4.0/5.0

---

## 9. MVP风险管理

### 9.1 技术风险

| 风险 | 概率 | 影响 | 应对措施 |
|------|------|------|----------|
| 性能不达标 | 中 | 高 | 早期性能测试，及时优化 |
| 安全漏洞 | 低 | 高 | 安全审计，渗透测试 |
| 技术选型错误 | 低 | 中 | 技术调研，POC验证 |
| 第三方依赖问题 | 中 | 中 | 选择成熟方案，有备选方案 |

### 9.2 项目风险

| 风险 | 概率 | 影响 | 应对措施 |
|------|------|------|----------|
| 进度延期 | 中 | 高 | 每周评估，及时调整 |
| 需求变更 | 中 | 中 | 需求冻结，严格控制变更 |
| 人员流动 | 低 | 中 | 知识文档化，结对编程 |
| 预算超支 | 低 | 低 | 精确估算，预留缓冲 |

---

## 10. MVP总结

### 核心理念

**简单优先，快速验证**

1. **最小可行**: 只实现最核心的功能
2. **快速迭代**: 尽快发布，收集反馈
3. **质量保证**: 不牺牲代码质量
4. **用户导向**: 从用户需求出发

### 成功关键

1. **明确目标**: 知道MVP要解决什么问题
2. **专注核心**: 不被非必要功能分心
3. **快速反馈**: 尽早让用户试用
4. **持续改进**: 根据反馈快速调整

### 下一步

MVP发布后：
1. 收集用户反馈
2. 分析数据指标
3. 规划v1.1版本
4. 持续优化改进

记住：**MVP不是终点，而是起点！**
